name: Deploy Repos A and B

on:
  push:
    branches:
      - '!main'
      - 'feature_version1'

jobs:
  deploycodeA:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code from Repo A
        uses: actions/checkout@v2
        with:
          repository: kalpanauppara/regional_repo
          ref: ${{ github.event.ref }}

      - name: Install Salesforce CLI
        run: |
          # Install Salesforce CLI
          curl -s https://developer.salesforce.com/media/salesforce-cli/sfdx-cli/channels/stable/sfdx-cli-linux-x64.tar.xz | tar xJf -
          sudo mv sfdx /usr/local/bin/
          sfdx --version
          # Install plugins or authenticate here as needed
          # Example: sfdx plugins:install sfdx-plugin-name

      - name: Create the content_deploy directory for Repo A
        run: mkdir content_deploy

      - name: Copy test.sh from Repo A to content_deploy
        run: |
            cp mycode/test.sh content_deploy/
            cd content_deploy
            ls -lrt

  deploycodeB:
    needs: deploycodeA
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code from Repo B
        uses: actions/checkout@v2
        with:
          repository: kalpanauppara/global_repo
          ref: Feature_branch

      - name: Create the content_deploy directory for Repo B
        run: mkdir content_deploy

      - name: Copy test.py from Repo B to content_deploy
        run: |
            cp mysourcecode/test.py content_deploy/
            cd content_deploy
            ls -lrt

  deployToSalesforce:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Salesforce (replace with your deployment command)
        run: |
          # Deploy the content from content_deploy to Salesforce
          sfdx force:source:deploy -p content_deploy/ -u YourSalesforceAlias
