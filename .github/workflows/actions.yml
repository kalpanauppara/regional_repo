name: Deploy Repos A and B

on:
  push:
    branches:
      - '!main'
      - 'feature_version1'

jobs:
  deploycodeA:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code from Repo A
        uses: actions/checkout@v2
        with:
          repository: kalpanauppara/regional_repo
          ref: ${{ github.event.ref }}
          path: ${{ github.workspace }}/repoA

      - name: Create a temporary directory for Repo A
        run: mkdir ${{ github.workspace }}/content_deploy_repoA

      - name: Copy test.sh from Repo A to content_deploy_repoA
        run: cp ${{ github.workspace }}/repoA/mycode/test.sh ${{ github.workspace }}/content_deploy_repoA/

  deploycodeB:
    needs: deploycodeA
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code from Repo B
        uses: actions/checkout@v2
        with:
          repository: kalpanauppara/global_repo
          ref: Feature_branch
          path: ${{ github.workspace }}/repoB

      - name: Create a temporary directory for Repo B
        run: mkdir ${{ github.workspace }}/content_deploy_repoB

      - name: Copy test.py from Repo B to content_deploy_repoB
        run: cp ${{ github.workspace }}/repoB/mysourcecode/test.py ${{ github.workspace }}/content_deploy_repoB/

  mergeContent:
    needs: [deploycodeA, deploycodeB]
    runs-on: ubuntu-latest
    steps:
      - name: Create a merged content directory
        run: mkdir ${{ github.workspace }}/content_deploy

      - name: Copy content from Repo A to merged content directory
        run: cp -r ${{ github.workspace }}/content_deploy_repoA/* ${{ github.workspace }}/content_deploy/

      - name: Copy content from Repo B to merged content directory
        run: cp -r ${{ github.workspace }}/content_deploy_repoB/* ${{ github.workspace }}/content_deploy/

  deployToSalesforce:
    needs: mergeContent
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Salesforce (replace with your deployment command)
        run: |
          # Deploy the merged content from content_deploy to Salesforce
          # Example: sfdx force:source:deploy -p ${{ github.workspace }}/content_deploy/ -u YourSalesforceAlias
