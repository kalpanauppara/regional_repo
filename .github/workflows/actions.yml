name: Deploy Repos A and B

on:
  push:
    branches:
      - '!main'
      - 'feature_version1'

jobs:
  deploycodeA:
    runs-on: ubuntu-latest
    outputs:
      test: ${{ steps.copyA.outputs.test }}
    steps:
      - name: Checkout code from Repo A
        uses: actions/checkout@v2
        with:
          repository: kalpanauppara/regional_repo
          ref: ${{ github.event.ref }}
      
      - name: Create the repoA_deploy directory
        run: mkdir repoA_deploy

      - name: Copy test.sh from Repo A to repoA_deploy
        run: |
            cp mycode/test.sh repoA_deploy/
            cd repoA_deploy
            ls -lrt
            pwd
          
      - name: List contents of repoA_deploy
        run: ls -lrt

      - name: Set job output for test.sh
        id: copyA
        run: echo "test=repoA_deploy/test.sh" >> ${{ github.workspace }}/.outputs

  deploycodeB:
    needs: deploycodeA
    runs-on: ubuntu-latest
    outputs:
      test: ${{ steps.copyB.outputs.test }}
    steps:
      - name: Checkout code from Repo B
        uses: actions/checkout@v2
        with:
          repository: kalpanauppara/global_repo
          ref: Feature_branch

      - name: Create the repoB_deploy directory
        run: mkdir repoB_deploy

      - name: Copy test.py from Repo B to repoB_deploy
        run: |
            cp mysourcecode/test.py repoB_deploy/
            cd repoB_deploy
            cd $GITHUB_WORKSPACE && ls -lrt
            ls -lrt
            pwd

      - name: List contents of repoB_deploy
        run: ls -lrt

      - name: Set job output for test.py
        id: copyB
        run: echo "test=repoB_deploy/test.py" >> ${{ github.workspace }}/.outputs

  mergeAndDeploy:
      needs:
      - deploycodeA
      - deploycodeB
      runs-on: ubuntu-latest
      steps:
      - name: Create the content_deploy directory
        run: mkdir content_deploy

      - name: Copy test.sh from repoA_deploy
        run: |
            cp ${{ needs.deploycodeA.outputs.test }} content_deploy/test.sh
          
      - name: Copy test.py from repoB_deploy
        run: |
            cp ${{ needs.deploycodeB.outputs.test }} content_deploy/test.py
            
      - name: List contents of content_deploy
        run: ls -lrt content_deploy

      - name: Deploy to Salesforce (replace with your deployment command)
        run: |
          # Deploy the content from content_deploy to Salesforce
          sfdx force:source:deploy -p content_deploy/ -u YourSalesforceAlias
